<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Ru Online Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* (Insert same CSS variables and header/footer styles as index.html here for consistency) */
        :root { --primary: #bb86fc; --bg-dark: #121212; --bg-card: #1e1e1e; --text-light: #ffffff; }
        body { background: var(--bg-dark); color: var(--text-light); font-family: sans-serif; margin: 0; }
        
        /* Search Bar */
        .search-bar { padding: 20px; text-align: center; }
        .search-bar input { width: 80%; padding: 10px; border-radius: 20px; border: none; outline: none; }

        /* Product Grid */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; padding: 20px; }
        .product-card { background: var(--bg-card); border-radius: 10px; overflow: hidden; padding-bottom: 10px; position: relative; cursor: pointer; transition: transform 0.2s; }
        .product-card:hover { transform: scale(1.02); }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .p-details { padding: 10px; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1em; }
        .discount { font-size: 0.8em; color: red; text-decoration: line-through; }
        
        /* Modal (Popup) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; overflow-y: auto; }
        .modal-content { background: #222; margin: 5% auto; padding: 20px; width: 90%; max-width: 600px; border-radius: 10px; position: relative; }
        .close-btn { position: absolute; top: 10px; right: 20px; font-size: 30px; cursor: pointer; }
        
        /* Cart */
        .cart-modal { display: none; position: fixed; bottom: 0; right: 0; width: 100%; max-width: 400px; background: #1a1a1a; border-top: 2px solid var(--primary); padding: 20px; z-index: 3000; height: 80vh; overflow-y: scroll; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        /* Buttons */
        .btn { padding: 10px; width: 100%; margin-top: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-buy { background: var(--primary); color: #000; }
        .btn-cart { background: #333; color: #fff; border: 1px solid #fff; }

        /* Form Styling */
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; background: #333; color: #fff; border: 1px solid #555; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="search-bar">
        <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="Search products...">
        <button onclick="toggleCart()" style="float: right; padding: 10px; background: var(--primary); border: none; border-radius: 5px;"><i class="fas fa-shopping-cart"></i> Cart <span id="cartCount">0</span></button>
    </div>

    <div class="product-grid" id="productContainer">
        </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <img id="m-img" src="" style="width:100%; border-radius:10px;">
            <div style="display:flex; gap:5px; margin-top:5px;">
                </div>
            <h2 id="m-name"></h2>
            <p class="price" id="m-price"></p>
            <p id="m-desc"></p>
            <p>Stock: <span id="m-stock"></span> | Warranty: <span id="m-warranty"></span></p>
            
            <label>Color/Size:</label>
            <select id="m-variant" onchange="updateVariantPrice()">
                <option value="Default">Default</option>
                <option value="Red">Red (+100 LKR)</option>
                <option value="Blue">Blue</option>
            </select>

            <div style="margin-top: 20px;">
                <h3>Customer Reviews</h3>
                <div style="background:#333; padding:10px; border-radius:5px;">
                    <p><strong>Sudeera:</strong> Good product! <i class="fas fa-star" style="color:gold"></i><i class="fas fa-star" style="color:gold"></i></p>
                    <img src="https://via.placeholder.com/50" alt="proof">
                </div>
            </div>

            <button class="btn btn-buy" onclick="addToCart(currentProduct, true)">Buy Now</button>
            <button class="btn btn-cart" onclick="addToCart(currentProduct, false)">Add to Cart</button>
        </div>
    </div>

    <div id="cartModal" class="cart-modal">
        <h2>Your Cart</h2>
        <button onclick="toggleCart()" style="background:red; color:white; border:none; padding:5px;">Close</button>
        <div id="cartItems"></div>
        <hr>
        <h3>Total: LKR <span id="cartTotal">0</span></h3>
        
        <h3>Checkout</h3>
        <form id="checkoutForm" onsubmit="processCheckout(event)">
            <input type="text" id="c-name" placeholder="Your Name (Required)" required>
            <input type="text" id="c-address" placeholder="Address (Required)" required>
            <input type="tel" id="c-phone" placeholder="WhatsApp Number (Required)" required>
            <input type="tel" id="c-phone2" placeholder="Secondary Number">
            <select id="c-district" required>
                <option value="">Select District</option>
                <option value="Colombo">Colombo</option>
                <option value="Gampaha">Gampaha</option>
                <option value="Kalutara">Kalutara</option>
                </select>
            <select id="c-payment">
                <option value="COD">Cash On Delivery</option>
                <option value="Bank">Bank Transfer</option>
            </select>
            <label><input type="checkbox" required> Agree to Rules</label>
            <button type="submit" class="btn btn-buy">Confirm Order via WhatsApp</button>
        </form>
    </div>

    <script>
        // MOCK DATA (ප්‍රොඩක්ට් 10ක්)
        const products = [
            { id: 1, name: "Oil Sprayer", price: 1500, discount: 1800, img: "https://via.placeholder.com/300", stock: 10, sold: 50, rating: 4.5, desc: "High quality oil sprayer for kitchen." },
            { id: 2, name: "Waste Bin", price: 850, discount: 1000, img: "https://via.placeholder.com/300", stock: 20, sold: 120, rating: 4.8, desc: "Hanging kitchen waste bin." },
            { id: 3, name: "Veg Peeler", price: 350, discount: 500, img: "https://via.placeholder.com/300", stock: 100, sold: 300, rating: 4.2, desc: "Stainless steel peeler." },
            // Add 7 more items here following same format...
        ];

        let cart = JSON.parse(localStorage.getItem('ruCart')) || [];
        let currentProduct = {};

        // Render Products
        function renderProducts(list) {
            const container = document.getElementById('productContainer');
            container.innerHTML = list.map(p => `
                <div class="product-card" onclick="openProduct(${p.id})">
                    <img src="${p.img}" alt="${p.name}">
                    <div class="p-details">
                        <h4>${p.name}</h4>
                        <p class="price">LKR ${p.price} <span class="discount">${p.discount}</span></p>
                        <small>Sold: ${p.sold} | <i class="fas fa-star" style="color:gold"></i> ${p.rating}</small>
                        <p style="color:#03dac6; font-size:0.8em;">Free Delivery</p>
                        <button class="btn btn-buy" onclick="event.stopPropagation(); openProduct(${p.id})">View</button>
                    </div>
                </div>
            `).join('');
        }
        renderProducts(products);

        // Search Logic
        function searchProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(query));
            renderProducts(filtered);
        }

        // Open Modal
        function openProduct(id) {
            currentProduct = products.find(p => p.id === id);
            document.getElementById('m-name').innerText = currentProduct.name;
            document.getElementById('m-price').innerText = `LKR ${currentProduct.price}`;
            document.getElementById('m-desc').innerText = currentProduct.desc;
            document.getElementById('m-stock').innerText = currentProduct.stock;
            document.getElementById('m-img').src = currentProduct.img;
            document.getElementById('productModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        // Cart Logic
        function addToCart(product, buyNow) {
            const existing = cart.find(item => item.id === product.id);
            if(existing) {
                existing.qty++;
            } else {
                cart.push({...product, qty: 1});
            }
            updateCartUI();
            if(buyNow) toggleCart();
            closeModal();
        }

        function updateCartUI() {
            localStorage.setItem('ruCart', JSON.stringify(cart));
            document.getElementById('cartCount').innerText = cart.reduce((acc, item) => acc + item.qty, 0);
            
            const cartHtml = cart.map((item, index) => `
                <div class="cart-item">
                    <div>
                        <h4>${item.name}</h4>
                        <p>LKR ${item.price} x ${item.qty}</p>
                    </div>
                    <div>
                        <button onclick="changeQty(${index}, 1)">+</button>
                        <button onclick="changeQty(${index}, -1)">-</button>
                        <button onclick="removeItem(${index})" style="background:red; border:none; color:white;">x</button>
                    </div>
                </div>
            `).join('');
            document.getElementById('cartItems').innerHTML = cartHtml;
            
            const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            document.getElementById('cartTotal').innerText = total;
        }

        function changeQty(index, delta) {
            cart[index].qty += delta;
            if(cart[index].qty <= 0) cart.splice(index, 1);
            updateCartUI();
        }

        function removeItem(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function toggleCart() {
            const el = document.getElementById('cartModal');
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
            updateCartUI();
        }

        // Checkout & WhatsApp Integration
        function processCheckout(e) {
            e.preventDefault();
            const name = document.getElementById('c-name').value;
            const address = document.getElementById('c-address').value;
            const phone = document.getElementById('c-phone').value;
            const district = document.getElementById('c-district').value;
            const payment = document.getElementById('c-payment').value;
            
            // Build Message
            let msg = `*New Order - Ru Online Store*\n\n`;
            msg += `*Name:* ${name}\n`;
            msg += `*Address:* ${address}\n`;
            msg += `*Phone:* ${phone}\n`;
            msg += `*District:* ${district}\n`;
            msg += `*Payment:* ${payment}\n\n`;
            msg += `*Items:*\n`;
            
            cart.forEach(item => {
                msg += `- ${item.name} (x${item.qty}) : LKR ${item.price * item.qty}\n`;
            });
            
            const total = document.getElementById('cartTotal').innerText;
            msg += `\n*Total Amount:* LKR ${total}`;
            
            // Open WhatsApp
            const url = `https://wa.me/94775048455?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
            
            // Clear Cart
            cart = [];
            updateCartUI();
            toggleCart();
        }
    </script>
</body>
</html>
